<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>會員中心 - RENE CELL</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&family=Noto+Serif+TC:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>

<body>

    <div class="d-flex">

        <div class="d-flex flex-column flex-shrink-0 p-4 bg-white sidebar shadow-sm d-none d-lg-block">
            <a href="{{ url_for('index') }}" class="d-flex align-items-center mb-4 text-decoration-none px-2">
                <span class="fs-4 fw-bold serif-font text-brand">RENE CELL</span>
            </a>

            <ul class="nav nav-pills flex-column mb-auto" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                <li class="nav-item">
                    <button class="nav-link w-100 text-start active" id="v-pills-overview-tab" data-bs-toggle="pill"
                        data-bs-target="#v-pills-overview" type="button" role="tab">
                        <i class="bi bi-speedometer2 me-2"></i> 總覽 Dashboard
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link w-100 text-start" id="v-pills-products-tab" data-bs-toggle="pill"
                        data-bs-target="#v-pills-products" type="button" role="tab">
                        <i class="bi bi-box-seam me-2"></i> 產品管理
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link w-100 text-start" id="v-pills-videos-tab" data-bs-toggle="pill"
                        data-bs-target="#v-pills-videos" type="button" role="tab">
                        <i class="bi bi-play-btn me-2"></i> 影片管理
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link w-100 text-start" id="v-pills-wishlist-tab" data-bs-toggle="pill"
                        data-bs-target="#v-pills-wishlist" type="button" role="tab">
                        <i class="bi bi-images me-2"></i> 圖片管理
                    </button>
                </li>
                {# <li class="nav-item">
                    <button class="nav-link w-100 text-start" id="v-pills-settings-tab" data-bs-toggle="pill"
                        data-bs-target="#v-pills-settings" type="button" role="tab">
                        <i class="bi bi-person-gear me-2"></i> 帳號設定
                    </button>
                </li> #}
            </ul>

            <hr class="my-4">

            <div class="dropdown px-2">
                <a href="#" class="d-flex align-items-center text-dark text-decoration-none dropdown-toggle"
                    id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
                    <div class="bg-brand text-white rounded-circle d-flex align-items-center justify-content-center me-2 shadow-sm"
                        style="width: 38px; height: 38px;">
                        {{ name[0] }}
                    </div>
                    <strong>{{ name }}</strong>
                </a>
                <ul class="dropdown-menu text-small shadow border-0" aria-labelledby="dropdownUser1">
                    <li><a class="dropdown-item" href="{{ url_for('index') }}">回到首頁</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item text-danger" href="{{ url_for('logout') }}">安全登出</a></li>
                </ul>
            </div>
        </div>

        <nav class="navbar navbar-light bg-white shadow-sm fixed-top d-lg-none px-3">
            <div class="container-fluid p-0">
                <a class="navbar-brand serif-font fw-bold text-brand" href="#">RENE CELL</a>
                <button class="btn btn-sm btn-outline-secondary border-0" type="button" data-bs-toggle="offcanvas"
                    data-bs-target="#mobileMenu">
                    <i class="bi bi-list fs-4"></i>
                </button>
            </div>
        </nav>

        <main class="flex-grow-1 p-4 p-md-5">
            <div class="container-fluid mt-5 mt-lg-0">

                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2 class="fw-bold serif-font mb-1">早安，{{ name }} ✨</h2>
                        <p class="text-muted small">歡迎回來，這是您的會員專屬空間。</p>
                    </div>
                    <a href="{{ url_for('logout') }}"
                        class="btn btn-outline-secondary rounded-pill d-none d-lg-block btn-sm px-3">登出</a>
                </div>

                {% with messages = get_flashed_messages() %}
                {% if messages %}
                <div class="alert alert-info border-0 shadow-sm rounded-4 mb-4">
                    <i class="bi bi-info-circle-fill me-2"></i> {{ messages[0] }}
                </div>
                {% endif %}
                {% endwith %}

                <div class="tab-content" id="v-pills-tabContent">

                    <div class="tab-pane fade show active animate-fade-in" id="v-pills-overview" role="tabpanel">
                        <div class="row g-4 mb-5">
                            <div class="col-md-4">
                                <div class="card stat-card h-100 p-3">
                                    <div class="card-body d-flex align-items-center">
                                        <div class="icon-box-lg bg-light-brand text-brand me-3"><i
                                                class="bi bi-box-seam"></i></div>
                                        <div><small class="text-muted d-block">產品總數</small>
                                            <h5 class="fw-bold mb-0">{{ products|length }} 項</h5>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card stat-card h-100 p-3">
                                    <div class="card-body d-flex align-items-center">
                                        <div class="icon-box-lg bg-info bg-opacity-10 text-info me-3"><i
                                                class="bi bi-play-btn"></i></div>
                                        <div><small class="text-muted d-block">影片總數</small>
                                            <h5 class="fw-bold mb-0">{{ videos|length }} 部</h5>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade animate-fade-in" id="v-pills-products" role="tabpanel">
                        <div class="card border-0 shadow-sm rounded-4">
                            <div
                                class="card-header bg-white border-0 py-3 d-flex justify-content-between align-items-center">
                                <h5 class="fw-bold mb-0">所有產品列表</h5>
                                <button class="btn btn-brand btn-sm rounded-pill px-3 shadow-sm" data-bs-toggle="modal"
                                    data-bs-target="#productModal" onclick="clearForm()">
                                    <i class="bi bi-plus-lg me-1"></i>新增產品
                                </button>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover align-middle mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th scope="col" class="ps-4 py-3 text-muted small">產品資訊 PRODUCT</th>
                                                <th scope="col" class="py-3 text-muted small">分類 CATEGORY</th>
                                                <th scope="col" class="py-3 text-end text-muted small">售價 PRICE</th>
                                                <th scope="col" class="py-3 text-end pe-4 text-muted small">操作 ACTION
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for product in products %}
                                            <tr>
                                                <td class="ps-4 py-3">
                                                    <div class="d-flex align-items-center">
                                                        <div class="ratio ratio-1x1 rounded-3 overflow-hidden shadow-sm me-3 border"
                                                            style="width: 50px; height: 50px;">
                                                            <img src="{{ url_for('static', filename='images/' + product.image) }}"
                                                                class="object-fit-cover" alt="product">
                                                        </div>
                                                        <div>
                                                            <h6 class="fw-bold mb-0 text-dark">{{ product.name }}</h6>
                                                            <small class="text-muted" style="font-size: 11px;">ID: #{{
                                                                product.id }}</small>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    {% if product.category == 'skincare' %}
                                                    <span
                                                        class="badge bg-warning bg-opacity-25 text-dark px-3 py-2 rounded-pill">護膚系列</span>
                                                    {% elif product.category == 'premium' %}
                                                    <span
                                                        class="badge bg-brand bg-opacity-10 text-white px-3 py-2 rounded-pill">高級系列</span>
                                                    {% elif product.category == 'mask' %}
                                                    <span
                                                        class="badge bg-info bg-opacity-10 text-info px-3 py-2 rounded-pill">面膜系列</span>
                                                    {% else %}
                                                    <span
                                                        class="badge bg-secondary bg-opacity-10 text-secondary px-3 py-2 rounded-pill">特別護理</span>
                                                    {% endif %}
                                                </td>
                                                <td class="text-end fw-bold text-dark">
                                                    {{ product.price }}
                                                </td>
                                                <td class="text-end pe-4">
                                                    <button
                                                        class="btn btn-sm btn-white border shadow-sm rounded-circle me-2"
                                                        title="編輯"
                                                        onclick='editProduct("{{ product.id }}", "{{ product.name }}", "{{ product.subtitle }}", "{{ product.category }}", "{{ product.price }}", "{{ product.original_price }}", "{{ product.badge_text }}", {{ product.description | tojson }}, {{ product.how_to_use | tojson }}, {{ product.user_reviews | tojson }})'>
                                                        <i class="bi bi-pencil-fill text-muted"></i>
                                                    </button>
                                                    <a href="{{ url_for('delete_product', id=product.id) }}"
                                                        class="btn btn-sm btn-white border shadow-sm rounded-circle text-danger"
                                                        title="刪除" onclick="return confirm('確定要刪除這個產品嗎？此動作無法復原。')">
                                                        <i class="bi bi-trash-fill"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                            {% else %}
                                            <tr>
                                                <td colspan="4" class="text-center py-5 text-muted">目前還沒有產品資料。</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade animate-fade-in" id="v-pills-videos" role="tabpanel">
                        <div class="card border-0 shadow-sm rounded-4">
                            <div
                                class="card-header bg-white border-0 py-3 d-flex justify-content-between align-items-center">
                                <h5 class="fw-bold mb-0">影片列表</h5>
                                <button class="btn btn-brand btn-sm rounded-pill px-3 shadow-sm" data-bs-toggle="modal"
                                    data-bs-target="#videoModal" onclick="clearVideoForm()">
                                    <i class="bi bi-plus-lg me-1"></i>新增影片
                                </button>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover align-middle mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th scope="col" class="ps-4 py-3 text-muted small">縮圖/預覽</th>
                                                <th scope="col" class="py-3 text-muted small">影片資訊</th>
                                                <th scope="col" class="py-3 text-muted small">類型</th>
                                                <th scope="col" class="py-3 text-end pe-4 text-muted small">操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for video in videos %}
                                            <tr>
                                                <td class="ps-4 py-3" width="120">
                                                    <div
                                                        class="ratio ratio-16x9 rounded-3 overflow-hidden shadow-sm border bg-dark">
                                                        {% if video.video_type == 'youtube' %}
                                                        <img src="https://img.youtube.com/vi/{{ video.filename }}/mqdefault.jpg"
                                                            class="object-fit-cover" alt="thumb">
                                                        {% else %}
                                                        <div
                                                            class="d-flex align-items-center justify-content-center h-100 text-white">
                                                            <i class="bi bi-file-earmark-play fs-4"></i>
                                                        </div>
                                                        {% endif %}
                                                    </div>
                                                </td>
                                                <td>
                                                    <h6 class="fw-bold mb-1 text-dark">{{ video.title }}</h6>
                                                    <small class="text-muted text-truncate d-block"
                                                        style="max-width: 250px;">{{ video.description }}</small>
                                                </td>
                                                <td>
                                                    {% if video.video_type == 'youtube' %}
                                                    <span
                                                        class="badge bg-danger bg-opacity-10 text-danger rounded-pill"><i
                                                            class="bi bi-youtube me-1"></i>YouTube</span>
                                                    {% else %}
                                                    <span
                                                        class="badge bg-primary bg-opacity-10 text-primary rounded-pill"><i
                                                            class="bi bi-file-earmark-arrow-up me-1"></i>File</span>
                                                    {% endif %}
                                                </td>
                                                <td class="text-end pe-4">
                                                    <button
                                                        class="btn btn-sm btn-white border shadow-sm rounded-circle me-2"
                                                        title="編輯"
                                                        onclick='editVideo("{{ video.id }}", {{ video.title | tojson }}, {{ video.description | tojson }}, "{{ video.video_type }}")'>
                                                        <i class="bi bi-pencil-fill text-muted"></i>
                                                    </button>
                                                    <a href="{{ url_for('delete_video', id=video.id) }}"
                                                        class="btn btn-sm btn-white border shadow-sm rounded-circle text-danger"
                                                        title="刪除" onclick="return confirm('確定要刪除這部影片嗎？')">
                                                        <i class="bi bi-trash-fill"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                            {% else %}
                                            <tr>
                                                <td colspan="4" class="text-center py-5 text-muted">目前還沒有影片資料。</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="v-pills-wishlist" role="tabpanel">
                        <h5 class="fw-bold mb-4">網站全站圖片管理</h5>
                        <div class="alert alert-info border-0 shadow-sm rounded-4 mb-4">
                            <i class="bi bi-lightbulb me-2"></i> 圖片上傳後將直接覆蓋舊圖，請按 <strong>Ctrl + F5</strong> 查看更新。
                        </div>
                        <div class="row g-4">
                            <div class="col-md-6 col-xl-4">
                                <div class="card h-100 border-0 shadow-sm rounded-4">
                                    <div class="card-header bg-white border-0 py-3 fw-bold">首頁主視覺 (Banner)</div>
                                    <div class="card-body">
                                        <div class="ratio ratio-16x9 rounded-3 overflow-hidden border mb-3"><img
                                                src="{{ url_for('static', filename='images/home_banner.jpg') }}?v={{ range(1,1000)|random }}"
                                                class="object-fit-cover"></div>
                                        <form action="{{ url_for('upload_image') }}" method="POST"
                                            enctype="multipart/form-data"><input type="hidden" name="target_filename"
                                                value="home_banner.jpg"><input class="form-control form-control-sm mb-2"
                                                type="file" name="image_file" accept="image/*" required><button
                                                type="submit"
                                                class="btn btn-brand btn-sm w-100 rounded-pill">更換圖片</button></form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-xl-4">
                                <div class="card h-100 border-0 shadow-sm rounded-4">
                                    <div class="card-header bg-white border-0 py-3 fw-bold">關於我們 (品牌形象)</div>
                                    <div class="card-body">
                                        <div class="ratio ratio-16x9 rounded-3 overflow-hidden border mb-3"><img
                                                src="{{ url_for('static', filename='images/about_brand.jpg') }}?v={{ range(1,1000)|random }}"
                                                class="object-fit-cover"></div>
                                        <form action="{{ url_for('upload_image') }}" method="POST"
                                            enctype="multipart/form-data"><input type="hidden" name="target_filename"
                                                value="about_brand.jpg"><input class="form-control form-control-sm mb-2"
                                                type="file" name="image_file" accept="image/*" required><button
                                                type="submit"
                                                class="btn btn-brand btn-sm w-100 rounded-pill">更換圖片</button></form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-xl-4">
                                <div class="card h-100 border-0 shadow-sm rounded-4">
                                    <div class="card-header bg-white border-0 py-3 fw-bold">煥膚見證 (Before/After)</div>
                                    <div class="card-body">
                                        <div class="ratio ratio-16x9 rounded-3 overflow-hidden border mb-3"><img
                                                src="{{ url_for('static', filename='images/transformation.jpg') }}?v={{ range(1,1000)|random }}"
                                                class="object-fit-cover"></div>
                                        <form action="{{ url_for('upload_image') }}" method="POST"
                                            enctype="multipart/form-data"><input type="hidden" name="target_filename"
                                                value="transformation.jpg"><input
                                                class="form-control form-control-sm mb-2" type="file" name="image_file"
                                                accept="image/*" required><button type="submit"
                                                class="btn btn-brand btn-sm w-100 rounded-pill">更換圖片</button></form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-xl-4">
                                <div class="card h-100 border-0 shadow-sm rounded-4">
                                    <div class="card-header bg-white border-0 py-3 fw-bold">事業機會 (獎金圖)</div>
                                    <div class="card-body">
                                        <div class="ratio ratio-16x9 rounded-3 overflow-hidden border mb-3"><img
                                                src="{{ url_for('static', filename='images/opportunity.jpg') }}?v={{ range(1,1000)|random }}"
                                                class="object-fit-cover"></div>
                                        <form action="{{ url_for('upload_image') }}" method="POST"
                                            enctype="multipart/form-data"><input type="hidden" name="target_filename"
                                                value="opportunity.jpg"><input class="form-control form-control-sm mb-2"
                                                type="file" name="image_file" accept="image/*" required><button
                                                type="submit"
                                                class="btn btn-brand btn-sm w-100 rounded-pill">更換圖片</button></form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {# <div class="tab-pane fade animate-fade-in" id="v-pills-settings" role="tabpanel">
                        <div class="row">
                            <div class="col-md-9 col-lg-8">
                                <div class="card border-0 shadow-sm rounded-4 mb-4">
                                    <div class="card-header bg-white border-0 py-3">
                                        <h5 class="fw-bold mb-0">個人資料設定</h5>
                                    </div>
                                    <div class="card-body">
                                        <form>
                                            <div class="row mb-3">
                                                <div class="col-md-6 mb-3 mb-md-0"><label
                                                        class="form-label text-muted small">姓名</label><input type="text"
                                                        class="form-control rounded-pill" value="{{ name }}"></div>
                                                <div class="col-md-6"><label
                                                        class="form-label text-muted small">手機號碼</label><input
                                                        type="tel" class="form-control rounded-pill"
                                                        value="0912-345-678"></div>
                                            </div>
                                            <div class="mb-3"><label
                                                    class="form-label text-muted small">電子信箱</label><input type="email"
                                                    class="form-control rounded-pill" value="user@example.com" disabled>
                                            </div>
                                            <div class="mb-4"><label
                                                    class="form-label text-muted small">配送地址</label><input type="text"
                                                    class="form-control rounded-pill" value="台北市信義區..."></div><button
                                                type="button" class="btn btn-brand rounded-pill px-4">儲存變更</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> #}

                </div>
            </div>
        </main>
    </div>

    <div class="modal fade" id="productModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 rounded-4">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold" id="productModalLabel">新增/編輯產品</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body px-4 pb-4">
                    <form action="{{ url_for('manage_product') }}" method="POST" enctype="multipart/form-data"
                        id="productForm">
                        <input type="hidden" name="product_id" id="p_id">

                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label class="form-label text-muted small">產品主標題</label>
                                <input type="text" class="form-control rounded-pill" name="name" id="p_name" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label text-muted small">標籤文字 (選填)</label>
                                <input type="text" class="form-control rounded-pill" name="badge_text"
                                    id="p_badge_text">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-muted small">副標題/簡述</label>
                            <input type="text" class="form-control rounded-pill" name="subtitle" id="p_subtitle">
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label class="form-label text-muted small">分類</label>
                                <select class="form-select rounded-pill" name="category" id="p_category">
                                    <option value="skincare">護膚系列</option>
                                    <option value="premium">高級系列</option>
                                    <option value="mask">面膜系列</option>
                                    <option value="special">特別護理</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label text-muted small">原價</label>
                                <input type="text" class="form-control rounded-pill" name="original_price"
                                    id="p_original_price">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label text-muted small text-brand fw-bold">會員價</label>
                                <input type="text" class="form-control rounded-pill border-brand" name="price"
                                    id="p_price" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-muted small">產品亮點 (Check Point)</label>
                            <textarea class="form-control rounded-3" name="description" id="p_description"
                                rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-muted small">使用方法 (How to use)</label>
                            <textarea class="form-control rounded-3" name="how_to_use" id="p_how_to_use"
                                rows="2"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-muted small">用戶好評 (Review)</label>
                            <textarea class="form-control rounded-3" name="user_reviews" id="p_user_reviews"
                                rows="2"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-muted small">產品圖片</label>
                            <input type="file" class="form-control rounded-pill" name="image">
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-brand rounded-pill py-2">儲存產品資料</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="videoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 rounded-4">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold" id="videoModalLabel">新增影片</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body px-4 pb-4">
                    <form action="{{ url_for('manage_video') }}" method="POST" enctype="multipart/form-data"
                        id="videoForm">
                        <input type="hidden" name="video_id" id="v_id">

                        <div class="mb-3">
                            <label class="form-label text-muted small">影片主標題 (Title)</label>
                            <input type="text" class="form-control rounded-pill" name="title" id="v_title" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-muted small">副標題 / 描述 (Subtitle)</label>
                            <textarea class="form-control rounded-3" name="description" id="v_description"
                                rows="2"></textarea>
                        </div>

                        <div class="mb-3">
                            <label class="form-label text-muted small">影片來源</label>
                            <div class="d-flex gap-3 mb-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="video_type" id="type_youtube"
                                        value="youtube" checked onchange="toggleVideoInput()">
                                    <label class="form-check-label" for="type_youtube">YouTube 連結</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="video_type" id="type_file"
                                        value="file" onchange="toggleVideoInput()">
                                    <label class="form-check-label" for="type_file">上傳檔案 (MP4/MOV)</label>
                                </div>
                            </div>

                            <div id="input_youtube_box">
                                <input type="text" class="form-control rounded-pill" name="youtube_url"
                                    placeholder="例如: https://youtu.be/dQw4w9WgXcQ">
                            </div>
                            <div id="input_file_box" style="display: none;">
                                <input type="file" class="form-control rounded-pill" name="video_file"
                                    accept="video/mp4,video/quicktime">
                                <small class="text-muted">支援 MP4, MOV 格式</small>
                            </div>
                        </div>

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-brand rounded-pill py-2">儲存影片</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileMenu">
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const urlParams = new URLSearchParams(window.location.search);
            const activeTab = urlParams.get('tab');

            if (activeTab === 'images') {
                new bootstrap.Tab(document.getElementById('v-pills-wishlist-tab')).show();
            } else if (activeTab === 'products') {
                new bootstrap.Tab(document.getElementById('v-pills-products-tab')).show();
            } else if (activeTab === 'videos') {
                new bootstrap.Tab(document.getElementById('v-pills-videos-tab')).show();
            }
        });

        // 產品編輯 (保持不變)
        function editProduct(id, name, subtitle, category, price, original_price, badge_text, description, how_to_use, user_reviews) {
            document.getElementById('productModalLabel').innerText = '編輯產品';
            document.getElementById('p_id').value = id;
            document.getElementById('p_name').value = name;
            document.getElementById('p_subtitle').value = subtitle || '';
            document.getElementById('p_category').value = category;
            document.getElementById('p_price').value = price;
            document.getElementById('p_original_price').value = original_price || '';
            document.getElementById('p_badge_text').value = badge_text || '';
            document.getElementById('p_description').value = description;
            document.getElementById('p_how_to_use').value = how_to_use || '';
            document.getElementById('p_user_reviews').value = user_reviews || '';
            new bootstrap.Modal(document.getElementById('productModal')).show();
        }

        // [新增] 影片編輯
        function editVideo(id, title, description, type) {
            document.getElementById('videoModalLabel').innerText = '編輯影片 (如需更換影片請刪除後重傳)';
            document.getElementById('v_id').value = id;
            document.getElementById('v_title').value = title;
            document.getElementById('v_description').value = description || '';

            // 編輯模式下，通常不建議直接改類型或檔案，這裡僅允許改文字
            // 若要更換影片，建議刪除重傳比較安全
            new bootstrap.Modal(document.getElementById('videoModal')).show();
        }

        // 清空產品表單
        function clearForm() {
            document.getElementById('productModalLabel').innerText = '新增產品';
            document.getElementById('productForm').reset();
            document.getElementById('p_id').value = '';
        }

        // [新增] 清空影片表單
        function clearVideoForm() {
            document.getElementById('videoModalLabel').innerText = '新增影片';
            document.getElementById('videoForm').reset();
            document.getElementById('v_id').value = '';
            toggleVideoInput(); // 重置顯示狀態
        }

        // [新增] 切換 YouTube/File 輸入框
        function toggleVideoInput() {
            const isYoutube = document.getElementById('type_youtube').checked;
            document.getElementById('input_youtube_box').style.display = isYoutube ? 'block' : 'none';
            document.getElementById('input_file_box').style.display = isYoutube ? 'none' : 'block';
        }

        function triggerTab(tabId) {
            const tabButton = document.getElementById(tabId);
            if (tabButton) { new bootstrap.Tab(tabButton).show(); }
            const mobileMenu = document.getElementById('mobileMenu');
            const bsOffcanvas = bootstrap.Offcanvas.getInstance(mobileMenu);
            if (bsOffcanvas) { bsOffcanvas.hide(); }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>

</html>